<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TwinTalk - Auth</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
    body {
      background: url('https://img.freepik.com/premium-photo/thoughtful-robot-white-background-ai-generative_955712-4604.jpg?w=2000') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255, 255, 255, 0.1); z-index: 0; }
    .auth-wrapper {
      display: flex; width: 900px; height: 550px; background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 20px rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden;
      position: relative; z-index: 1; transform: translateX(260px);
    }
    .left-panel { width: 50%; background-color: #4b2aad; color: #fff; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
    .left-panel h1 { font-size: 72px; font-weight: 800; line-height: 1; margin-bottom: 20px; }
    .left-panel p { font-size: 16px; margin-bottom: 30px; line-height: 1.5; }
    .left-panel ul { list-style: none; font-size: 14px; }
    .left-panel ul li { margin-bottom: 10px; position: relative; padding-left: 20px; }
    .left-panel ul li::before { content: "✔"; position: absolute; left: 0; color: #fff; }
    .right-panel { width: 50%; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
    .tabs { display: flex; margin-bottom: 20px; }
    .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: bold; border-bottom: 2px solid transparent; }
    .tab.active { border-bottom: 2px solid #ad2aad; color: #4b2aad; }
    .form-title { font-size: 24px; margin-bottom: 10px; }
    .form-subtitle { font-size: 14px; margin-bottom: 20px; color: #666; }
    form input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
    form button { width: 100%; padding: 12px; background-color: #4b2aad; color: #fff; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
    form button:hover { background-color: #3a1f8f; }
    .terms { font-size: 12px; color: #999; margin-top: 10px; text-align: center; }
    .logo-circle { position: absolute; top: 20px; right: 20px; background-color: #4b2aad; color: #fff; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 16px; z-index: 2; }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="auth-wrapper">
    <div class="logo-circle">TT</div>
    <div class="left-panel">
      <h1>TalkTwin</h1>
      <p>Connect, communicate, and collaborate with people around the world in real-time.</p>
      <ul>
        <li>Instant messaging & video calls</li>
        <li>AI Avatar for unavailable moments</li>
        <li>Secure end-to-end encryption</li>
        <li>Cross-platform compatibility</li>
      </ul>
    </div>
    <div class="right-panel">
      <div class="tabs">
        <div class="tab active" id="signinTab">Sign In</div>
        <div class="tab" id="signupTab">Sign Up</div>
      </div>

      <div id="formTitle" class="form-title">Welcome back</div>
      <div id="formSubtitle" class="form-subtitle">Sign in to your TalkTwin account</div>

      <form id="authForm">
        <input type="text" id="username" placeholder="Enter your name" style="display:none" />
        <input type="email" id="email" placeholder="Enter your email" required />
        <input type="password" id="password" placeholder="Enter your password" required />
        <button type="submit">Sign In</button>
      </form>

      <div class="terms">By continuing, you agree to our Terms of Service and Privacy Policy</div>
    </div>
  </div>

  <script>
    let mode = "signin"; // default mode

    const signinTab = document.getElementById("signinTab");
    const signupTab = document.getElementById("signupTab");
    const formTitle = document.getElementById("formTitle");
    const formSubtitle = document.getElementById("formSubtitle");
    const usernameField = document.getElementById("username");
    const submitBtn = document.querySelector("button");

    signinTab.onclick = () => switchMode("signin");
    signupTab.onclick = () => switchMode("signup");

    function switchMode(m) {
      mode = m;
      if (m === "signin") {
        signinTab.classList.add("active");
        signupTab.classList.remove("active");
        usernameField.style.display = "none";
        formTitle.textContent = "Welcome back";
        formSubtitle.textContent = "Sign in to your TalkTwin account";
        submitBtn.textContent = "Sign In";
      } else {
        signupTab.classList.add("active");
        signinTab.classList.remove("active");
        usernameField.style.display = "block";
        formTitle.textContent = "Create Account";
        formSubtitle.textContent = "Join TalkTwin and start connecting";
        submitBtn.textContent = "Sign Up";
      }
    }

    // Default tab
    switchMode("signin");

    // ✅ NEW redirect logic (preserves meeting link)
    function redirectAfterAuth(user) {
      sessionStorage.setItem("user", JSON.stringify(user));
      const redirectUrl = sessionStorage.getItem("postLoginRedirect") || "/index.html";
      sessionStorage.removeItem("postLoginRedirect");
      window.location.href = redirectUrl;
    }

    document.getElementById("authForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = usernameField.value.trim();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const password = document.getElementById("password").value.trim();

      const endpoint = mode === "signup" ? "/signup" : "/login";
      const payload = mode === "signup" ? { name, email, password } : { email, password };

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (res.ok) {
          if (mode === "signup") {
            alert("✅ Signup successful! Please login now.");
            switchMode("signin");
          } else {
            alert("✅ Login successful!");
            redirectAfterAuth({ name: data.user?.name || name, email });
          }
        } else {
          alert(data.message || "❌ Invalid credentials.");
        }
      } catch (err) {
        alert("⚠️ Network error: " + err.message);
      }
    });

    const existingUser = sessionStorage.getItem("user");
    if (existingUser) window.location.href = "/index.html";
  </script>
</body>
</html>
